# 在线秒杀系统接口文档

## 1. 接口概述

### 1.1 接口风格
- 基于Spring Boot开发
- JSON格式数据交换

### 1.2 通用响应格式
```json
{
  "code": 200,               // 响应码，200表示成功
  "message": "success",     // 响应消息
  "data": {}                // 响应数据
}
```

### 1.3 响应码定义
| 响应码 | 描述 |
|-------|------|
| 200 | 成功 |
| 201 | 失败 |

## 2. 用户认证接口

### 2.1 用户注册
- **路径**: `/api/auth/register`
- **方法**: `POST`
- **请求参数**:
  ```json
  {
    "username": "test_user",
    "password": "123456",
    "nickname": "测试用户",
    "phone": "13800138000",
    "email": "test@example.com"
  }
  ```
- **响应示例**:
  
  ```json
  {
    "code": 200,
    "message": "注册成功",
    "data": {
      "id": 1,
      "username": "test_user",
      "nickname": "测试用户"
    }
  }
  ```

### 2.2 用户登录
- **路径**: `/api/auth/login`
- **方法**: `POST`
- **请求参数**:
  ```json
  {
    "username": "test_user",
    "password": "123456"
  }
  ```
- **响应示例**:
  
  ```json
  {
    "code": 200,
    "message": "登录成功",
    "data": {
      "token": "eyJhb...",
      "user": {
        "username": "test_user",
        "nickname": "测试用户",
        "avatar":"url"
      }
    }
  }
  ```

### 2.3 获取用户信息
- **路径**: `/api/auth/me`

- **方法**: `GET`

- **请求参数**:

  ```json
  {
    "username": "test_user",
  }
  ```

- **响应示例**:
  
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": 1,
      "username": "test_user",
      "nickname": "测试用户",
      "phone": "13800138000",
      "email": "test@example.com",
      "avatar": "url"
    }
  }
  ```
  
  ### 2.4 获取验证码(先使用邮箱发送)
  
  - **路径**: `/api/auth/getVerCode`
  
  - **方法**: `GET`
  
  - **请求参数**:
  
    ```json
    {
      "email": "123@qq.com",
    }
    ```
  
  - **响应示例**:
  
  ```
  {
    "code": 200,
    "message": "success",
    "data": {
      "code": "1233456"， //6位数验证码用于注册
    }
  }
  ```
  
  

## 3. 商品相关接口

### 3.1 获取秒杀商品列表
- **路径**: `/api/seckill/products`
- **方法**: `GET`
- **请求参数**:
  - `page`: 页码，默认1
  - `size`: 每页数量，默认10
  - 检索条件：`status`: 状态（0未开始，1进行中，2已结束）
- **响应示例**:
  
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "total": 100,
      "pages": 10,
      "list": [
        {
          "id": 1,
          "productId": 1001,
          "name": "iPhone 13 Pro",
          "description": "最新款iPhone",
          "originalPrice": 7999.00,
          "seckillPrice": 5999.00,
          "stock": 100,//库存
          "availableStock": 98,
          "startTime": "2023-12-01 10:00:00",
          "endTime": "2023-12-01 11:00:00",
          "status": 1,
          "imageUrl": "http://example.com/iphone.jpg"
        }
      ]
    }
  }
  ```

### 3.2 获取秒杀商品详情
- **路径**: `/api/seckill/products/{id}`
- **方法**: `GET`
- **响应示例**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": 1,
      "productId": 1001,
      "name": "iPhone 13 Pro",
      "description": "最新款iPhone",
      "originalPrice": 7999.00,
      "seckillPrice": 5999.00,
      "stock": 100,
      "availableStock": 98,
      "startTime": "2023-12-01 10:00:00",
      "endTime": "2023-12-01 11:00:00",
      "status": 1,
      "imageUrl": "http://example.com/iphone.jpg",
      "remainSeconds": 3600
    }
  }
  ```

### 3.3 获取商品详情（非秒杀）
- **路径**: `/api/products/{id}`
- **方法**: `GET`
- **响应示例**:
  
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": 1001,
      "name": "iPhone 13 Pro",
      "description": "最新款iPhone",
      "originalPrice": 7999.00,
      "imageUrl": "http://example.com/iphone.jpg",
      "status": 1
    }
  }
  ```

## 4. 秒杀核心接口

### 4.1 秒杀商品下单
- **路径**: `/api/seckill/order`
- **方法**: `POST`
- **请求头**: `Authorization:{token}`
- **请求参数**:
  
  ```json
  {
    "seckillProductId": 1,
    "quantity": 1
  }
  ```
- **响应示例**:
  
  ```json
  {
    "code": 200,
    "message": "秒杀成功",
    "data": {
      "orderId": 10001,
      "orderNo": "SK20231201123456789",
      "amount": 5999.00,
      "paymentUrl": "http://pay.example.com/pay?orderNo=SK20231201123456789"
    }
  }
  ```
- **错误响应示例**:
  ```json
  {
    "code": 409,
    "message": "库存不足",
    "data": null
  }
  ```
  ```json
  {
    "code": 403,
    "message": "秒杀活动未开始",
    "data": null
  }
  ```
  ```json
  {
    "code": 409,
    "message": "您已抢购过该商品",
    "data": null
  }
  ```

## 5. 订单相关接口

### 5.1 获取订单详情
- **路径**: `/api/orders/{orderId}`
- **方法**: `GET`
- **请求头**: `Authorization: {token}`
- **响应示例**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": 10001,
      "orderNo": "SK20231201123456789",
      "productId": 1001,
      "productName": "iPhone 13 Pro",
      "seckillProductId": 1,
      "quantity": 1,
      "totalAmount": 5999.00,
      "status": 0,
      "createdAt": "2023-12-01 10:01:23",
      "paymentTime": null,
      "imageUrl": "http://example.com/iphone.jpg"
    }
  }
  ```

### 5.2 获取用户订单列表
- **路径**: `/api/orders`
- **方法**: `GET`
- **请求头**: `Authorization: {token}`
- **请求参数**:
  - `page`: 页码，默认1
  - `size`: 每页数量，默认10
  - `status`: 订单状态（可选）
- **响应示例**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "total": 10,
      "pages": 1,
      "list": [
        {
          "id": 10001,
          "orderNo": "SK20231201123456789",
          "productName": "iPhone 13 Pro",
          "totalAmount": 5999.00,
          "status": 0,
          "createdAt": "2023-12-01 10:01:23",
          "imageUrl": "http://example.com/iphone.jpg"
        }
      ]
    }
  }
  ```

### 5.3 取消订单
- **路径**: `/api/orders/{orderId}/cancel`
- **方法**: `POST`
- **请求头**: `Authorization: {token}`
- **响应示例**:
  ```json
  {
    "code": 200,
    "message": "订单已取消",
    "data": {
      "orderId": 10001,
      "status": 2
    }
  }
  ```

### 5.4 订单支付
- **路径**: `/api/orders/{orderId}/pay`
- **方法**: `POST`
- **请求头**: `Authorization: {token}`
- **请求参数**:
  ```json
  {
    "paymentType": 1,  // 1微信，2支付宝
    "returnUrl": "http://example.com/pay/success"
  }
  ```
- **响应示例**:
  
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "payUrl": "https://wx.tenpay.com/pay?orderNo=SK20231201123456789",
      "orderNo": "SK20231201123456789"
    }
  }
  ```

## 6. 支付相关接口

### 6.1 支付回调
- **路径**: `/api/pay/callback/{paymentType}`
- **方法**: `POST`
- **描述**: 第三方支付平台回调接口
- **请求参数**: 第三方支付平台标准回调参数
- **响应示例**:
  ```json
  {
    "code": "SUCCESS",
    "message": "支付成功"
  }
  ```

### 6.2 查询支付状态
- **路径**: `/api/pay/status/{orderNo}`
- **方法**: `GET`
- **请求头**: `Authorization:{token}`
- **响应示例**:
  
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "orderNo": "SK20231201123456789",
      "paid": true,
      "paymentTime": "2023-12-01 10:05:30"
    }
  }
  ```

## 7. 系统管理接口

### 7.2 添加秒杀商品
- **路径**: `/api/admin/seckill/products`
- **方法**: `POST`
- **请求头**: `Authorization: {token}`
- **请求参数**:
  ```json
  {
    "productId": 1001,
    "seckillPrice": 5999.00,
    "stock": 100,
    "startTime": "2023-12-01 10:00:00",
    "endTime": "2023-12-01 11:00:00"
  }
  ```
- **响应示例**:
  
  ```json
  {
    "code": 200,
    "message": "添加成功",
    "data": {
      "id": 1
    }
  }
  ```

### 7.3 更新秒杀商品
- **路径**: `/api/admin/seckill/products/{id}`
- **方法**: `PUT`
- **请求头**: `Authorization: {token}`
- **请求参数**: 同添加接口
- **响应示例**:
  ```json
  {
    "code": 200,
    "message": "更新成功",
    "data": {
      "id": 1
    }
  }
  ```

### 7.4 秒杀商品状态管理
- **路径**: `/api/admin/seckill/products/{id}/status`
- **方法**: `PUT`
- **请求头**: `Authorization: {token}`
- **请求参数**:
  ```json
  {
    "status": 1  // 1上架，0下架
  }
  ```
- **响应示例**:
  ```json
  {
    "code": 200,
    "message": "状态更新成功",
    "data": null
  }
  ```

### 7.5 系统监控统计
- **路径**: `/api/admin/monitor/stats`
- **方法**: `GET`
- **请求头**: `Authorization: {token}`
- **响应示例**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "totalUsers": 10000,
      "totalOrders": 5000,
      "totalSales": 29995000.00,
      "currentOnline": 1500,
      "topProducts": [
        {
          "productId": 1,
          "productName": "iPhone 13 Pro",
          "sales": 500
        }
      ]
    }
  }
  ```

## 8.收货地址相关接口

### 8.1 添加收货地址

- **路径**: `/api/addAddresses`

- **方法**: `POST`

- **请求头**: `Authorization:{token}`

- **请求参数**:

  ```json
  {
    "receiverName": "张三",
    "phone": "13800138000",
    "province": "广东省",
    "city": "深圳市",
    "district": "南山区",
    "detailAddress": "科技园路100号",
    "isDefault": true  // 是否默认地址
  }
  ```

- **响应示例**

  ```json
  {
    "code": 200,
    "message": "添加成功",
    "data": {
      "addressId": 1001,
      "receiverName": "张三",
      "phone": "13800138000",
      "province": "广东省",
      "city": "深圳市",
      "district": "南山区",
      "detailAddress": "科技园路100号",
      "isDefault": true
    }
  }
  ```

### 8.2 获取用户收货地址列表

- **路径**: `/api/getAddresses`

- **方法**: `GET`

- **请求头**: `Authorization:{token}`

- **响应示例**:

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "list": [
        {
          "addressId": 1001,
          "receiverName": "张三",
          "phone": "13800138000",
          "province": "广东省",
          "city": "深圳市",
          "district": "南山区",
          "detailAddress": "科技园路100号",
          "isDefault": true
        },
        {
          "addressId": 1002,
          "receiverName": "张三",
          "phone": "13800138000",
          "province": "广东省",
          "city": "广州市",
          "district": "天河区",
          "detailAddress": "天河路200号",
          "isDefault": false
        }
      ]
    }
  }
  ```

### 8.3更新收货地址

- **路径**: `/api/updataAddresses/{addressId}`

- **方法**: `POST`

- **请求头**: `Authorization:{token}`

- **请求参数**:

  ```json
  {
    "receiverName": "张三",
    "phone": "13800138000",
    "province": "广东省",
    "city": "深圳市",
    "district": "福田区",
    "detailAddress": "福田路300号",
    "isDefault": true
  }
  ```

- **响应示例**:

  ```json
  {
    "code": 200,
    "message": "更新成功",
    "data": {
      "addressId": 1001,
      "receiverName": "张三",
      "phone": "13800138000",
      "province": "广东省",
      "city": "深圳市",
      "district": "福田区",
      "detailAddress": "福田路300号",
      "isDefault": true
    }
  }
  ```

### 8.4 删除收货地址

- **路径**: `/api/dleAddresses/{addressId}`

- **方法**: `POST`

- **请求头**: `Authorization:{token}`

- **响应示例**:

  ```
  {
    "code": 200,
    "message": "删除成功",
    "data": null
  }
  ```

### 8.5 设置默认收货地址

- **路径**: `/api/dfaultAddresses/{addressId}`

- **方法**: `POST`

- **请求头**: `Authorization:{token}`

- **响应示例**:

  ```
  {
    "code": 200,
    "message": "设置成功",
    "data": {
      "addressId": 1002,
      "isDefault": true
    }
  }
  ```

  
